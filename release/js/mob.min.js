!function(a,b,c){"use strict";var d=function(b){var c=a(b);if(this.$el=a(c.attr("href")||c.data("target")),this.$el.hasClass("aside-push")){this.isPush=!0;var d=this.bindEl=a(this.$el.data("bind"));d.addClass("aside-push-obj").removeClass("aside-push-obj-right").removeClass("aside-push-obj-left").removeClass("aside-push-obj-top").removeClass("aside-push-obj-bottom"),this.$el.hasClass("aside-right")?this.bindClass="aside-push-obj-right":this.$el.hasClass("aside-left")?this.bindClass="aside-push-obj-left":this.$el.hasClass("aside-top")?this.bindClass="aside-push-obj-top":this.$el.hasClass("aside-bottom")&&(this.bindClass="aside-push-obj-bottom"),d.addClass(this.bindClass)}};d.prototype={show:function(){var a=this;this.$el.removeClass("slideout").addClass("show").addClass("slidein"),this._apear(this.$el),this.isPush?this.bindEl.removeClass("slideout").addClass("slidein").one("click",function(){a.hide.call(a)}).on("touchmove",this.bindEl,this._preventMove):this._addBackdrop()},hide:function(){this.$el.removeClass("slidein").addClass("slideout").removeClass("show"),this._disapear(this.$el),this.isPush?this.bindEl.removeClass("slidein").addClass("slideout").off("touchmove",this.bindEl,this._preventMove):this._removeBackdrop()},toggle:function(){this.$el.hasClass("show")?this.hide():this.show()},_disapear:function(a){setTimeout(function(){a.addClass("disapear")},300)},_apear:function(a){a.removeClass("disapear")},_addBackdrop:function(){var a=this;this.$el.after("<div class='aside-backdrop'></div>"),this.$el.siblings(".aside-backdrop").one("click",function(b){b.preventDefault(),b.stopPropagation(),this.remove(),a.hide()})},_removeBackdrop:function(){this.$el.siblings(".aside-backdrop").remove()},_preventMove:function(a){a.preventDefault()}},a.fn.aside=function(a){return this.each(function(){var b=new d(this);"string"==typeof a&&b[a]()})},a(c).on("click.data-api",'[data-aside="toggle"]',function(b){b.preventDefault(),a(this).aside("toggle")})}($,window,document),function(a,b){function c(a){var c=this;this.conf=a||{},this.os=null,this.camera=new g,this.checkEnv(),this.maskEl="#mask",this.action="vis.topgen",this.handlers={"self.cat":function(){void 0!=typeof detector&&detector.abortCurrent(),"ios"==this.os?b("#progress").text("猫脸识别暂不支持ios,请尝试其它功能"):detector.detectCats()},"self.more":function(){void 0!=typeof detector&&detector.abortCurrent(),f()},"vis.flower":function(){void 0!=typeof detector&&detector.abortCurrent();var a=b("#preview").get(0),d=a.toDataURL("image/jpeg");c.send(d)},"vis.topgen":function(){void 0!=typeof detector&&detector.abortCurrent();var a=b("#preview").get(0),d=a.toDataURL("image/jpeg");c.send(d)}}}c.prototype={snap:function(){b(this.conf.snap_image).trigger("click")},localSnap:function(){b(this.conf.local_snap_image).trigger("click")},detect:function(a,b){var c=this;this.step.snap.end(),this.maskShow(),this.step.detect.start();this.camera.getImage(function(a){b&&drawToCanvas(a),c.handlers[c.action](),setTimeout(function(){c.maskHide(),c.resultCallback&&c.resultCallback()},1e3)})},checkEnv:function(){/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)&&(this.os="ios")},bindEvents:function(){var a=this;b(this.conf.snap_btn).on("click",function(b){a.snap.call(a,b)}),b(this.conf.local_snap_btn).on("click",function(b){a.localSnap.call(a,b)}),b(this.conf.snap_image).on("change",function(b){a.camera.capture(b),a.detect.call(a,b,!0)}),b(this.conf.local_snap_image).on("change",function(b){a.camera.capture(b),a.detect.call(a,b,!0)})},bindClickTo:function(a){return this.conf.snap_btn=a,this},bindLocalSnapTo:function(a){return this.conf.local_snap_btn=a,this},setCameraInput:function(a){return this.conf.snap_image=a,this},setLocalInput:function(a){return this.conf.local_snap_image=a,this},setTabs:function(a){var c=this;return b(a).on("click",function(a){c.action=b(this).data("action"),c.detect(a)}),this},start:function(){return this.bindEvents(),this},step:{snap:{start:function(){return this.step},end:function(){return b("#camera").addClass("hide"),this.step}},detect:{start:function(){return b("#detect").removeClass("hide"),this.step},end:function(){return this.step}}},send:function(a){var c={img:a},f=this;b.post("/api/"+this.action,c,function(a){switch(f.action){case"vis.topgen":d(a);break;case"vis.flower":e(a)}},"json")},maskShow:function(){return b(this.maskEl).show(),this},maskHide:function(){return b(this.maskEl).hide(),this},onReady:function(a){return this.resultCallback=a,this}};var d=function(a){if(a&&a.status&&a.result&&a.result.GENERAL_CLASS&&a.result.GENERAL_CLASS.length){for(var c=a.result.GENERAL_CLASS,d="",e=0;e<c.length;e++)for(var f=c[e],g=f.name.split("-"),h=0;h<g.length;h++){var i=g[h];d+="<a href='http://m.baidu.com/s?word="+i+"&st=11104i&ts=2164184&sa=ib&tn=iphone&ss=11&ix=461%25' target='_blank'>"+i+"</a>"}b("#progress").html("您要找的是不是：<br>"+d)}else b("#progress").text("抱歉，没有找到与图片相关的内容")},e=function(a){if(a&&a.status&&a.result&&a.result.FLOWER_INFO&&a.result.FLOWER_INFO.length){for(var c=a.result.FLOWER_INFO,d="",e="",f=0;f<c.length;f++){var g=c[f];d+="<a href='http://m.baidu.com/s?word="+g.name+"&st=11104i&ts=2164184&sa=ib&tn=iphone&ss=11&ix=461%25' target='_blank'>"+g.name+"</a>",e+="<a href='http://m.baidu.com/img?tn=bdidxiphone#!/search/"+g.name+"' target='_blank'>"+g.name+"</a>"}b("#progress").html("<p>图片中的花可能是：</p><p>"+d+"</p><p>看看相似图片：</p><p>"+e+"</p>")}else b("#progress").text("抱歉，没有找到与图片相关的花")},f=function(){b("#progress").html("更多功能即将上线<br>敬请期待!")},g=function(){this.event=null};g.prototype={capture:function(a){return this.event=a,this.imgType="image/jpeg",this},getImage:function(a){return this.getImageByUrl(a)||this.getImageByFileRead(a)},getImageByUrl:function(a){var b=this.getUrl(),c=new Image;return c.src=b,c.onload=function(){a(c)},c},getImageByFileRead:function(){var a=this.getFile(this.event),b=new FileReader,c=new Image;return b.onload=function(a){c.src=a.target.result},b.readAsDataURL(a),c},getData:function(){return this.getDataByUrl()||this.getDataByFileRead()},getDataByUrl:function(){var a=this.getCanvasByUrl();return a.toDataURL(this.imgType)||null},getDataByFileRead:function(){var a=this.getCanvasByFileRead();return a.toDataURL(this.imgType)||null},getCanvas:function(){return this.getCanvasByUrl()||this.getCanvasByFileRead()},getCanvasByUrl:function(){var b=this.getFile(),c=a.URL||a.webkitURL,d=c.createObjectURL(b),e=document.createElement("canvas");return e.src=d,e},getCanvasByFileRead:function(){var a=this.getFile(),b=new FileReader,c=document.createElement("canvas");return b.onload=function(a){c.src=a.target.result},b.readAsDataURL(a),c},getFile:function(){var a,b=this.event.target.files;return b&&b.length>0?a=b[0]:null},getUrl:function(){var b=this.getFile(),c=a.URL||a.webkitURL,d=c.createObjectURL(b);return d}}}(window,$),function(){$(".aside").on("tap",function(){})}(window,document),function(a,b){"use strict";a.fn.Modal=function(){},a.fn.Dialog=function(b){var c=this;this.$el=b.el||a("#dialogPanel"),b&&(b.$el&&(this.$el=a(b.$el)),b.confirm&&(this.confirm=b.confirm)),this.$el.find(".btn-confirm").bind("click",function(){c.confirm&&c.confirm.call(c,this)}),this.$el.find(".btn-cancel").bind("click",function(){c.hide()})},a.fn.Dialog.prototype={pos:function(){this.$el.css({top:b.pageYOffset+.5*(b.innerHeight-85)+"px",left:.5*(b.innerWidth-216)+"px"})},show:function(b){this.showed||(this.pos(),b.msg&&a(".dialog-tip",this.$el).text(b.msg),this.$el.addClass("show"),this.showed=!0)},hide:function(){this.showed&&(this.$el.removeClass("show"),this.showed=!1)}}}($,window,document),function(a,b,c){"use strict";var d=function(b){this.element=a(b)};d.prototype={show:function(){var b=this.element,c=b.attr("data-target")||b.attr("href"),d=c?a(c):b,e=d.closest(".tab-content");if(!b.hasClass("active")){var f=e.find(".tab-pane.active");b.trigger("show",[f]),this.activate(d,e,function(){b.trigger("shown",[f])})}},activate:function(a,b,c){function d(){e.removeClass("active"),a.addClass("active"),f?(a[0].offsetWidth,a.addClass("in")):a.removeClass("fade"),c&&c()}var e=b.find(".tab-pane.active"),f=c&&e.hasClass("fade");f?e.one(f.end,d):d(),e.removeClass("in")}},a.fn.tab=function(a){return this.each(function(){var b=new d(this);"string"==typeof a&&b[a]()})},a(c).on("click.tab.data-api",'[data-toggle="tab"]',function(b){b.preventDefault(),a(this).tab("show")})}($,window,document),function(a){"use strict";var b=function(b){var c=this;b&&("string"==typeof b?(this.el=b,this.$el=a(this.el)):(this.$el=b.$el||a(b.el),this.confirm=b.confirm),this.$el.find(".btn-confirm").bind("click",function(){c.confirm&&c.confirm.call(c,this)}),this.$el.find(".btn-cancel").bind("click",function(){c.hide()}))};b.prototype={pos:function(){var a=this.$el.find(".modal-dialog");console.log(a),a.css({})},show:function(b){this.showed||(this.pos(),b&&b.msg&&a(".dialog-tip",this.$el).text(b.msg),this.$el.removeClass("hide").addClass("show"),this.showed=!0,a("body").append('<div class="modal-backdrop"></div>'))},hide:function(){this.showed&&(this.$el.removeClass("show").addClass("hide"),a(".modal-backdrop").remove(),this.showed=!1)}},a.fn.modal=function(a){var c=new b(a);return c}}($,window,document),function(a,b,c){"use strict";var d=function(b){this.element=a(b)};d.prototype={show:function(){var b=this.element,c=b.attr("data-target")||b.attr("href"),d=c?a(c):b,e=d.closest(".tab-content");if(!b.hasClass("active")){var f=e.find(".tab-pane.active");b.trigger("show",[f]),this.activate(d,e,function(){b.trigger("shown",[f])})}},activate:function(a,b,c){function d(){e.removeClass("active"),a.addClass("active"),f?(a[0].offsetWidth,a.addClass("in")):a.removeClass("fade"),c&&c()}var e=b.find(".tab-pane.active"),f=c&&e.hasClass("fade");f?e.one(f.end,d):d(),e.removeClass("in")}},a.fn.tab=function(a){return this.each(function(){var b=new d(this);"string"==typeof a&&b[a]()})},a(c).on("click.tab.data-api",'[data-toggle="tab"]',function(b){b.preventDefault(),a(this).tab("show")})}($,window,document),function(){$.os.android&&$(".tap").live("touchstart",function(){$(this).data("background",$(this).css("background")),$(this).css("background","#D9E9FF")}).live("touchend",function(){var a=$(this).data("background");a?$(this).css("background",a):$(this).css("background","transparent")}),$(document).on("click.tap","[data-url]",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).data("url");setTimeout(function(){location.href=b},300)}),$(document).on("click.tap","[data-openurl]",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).data("openurl");setTimeout(function(){window.open(b)},300)})}($,window,document),$.os.iphone&&setTimeout(function(){window.scrollTo(0,0)},0);